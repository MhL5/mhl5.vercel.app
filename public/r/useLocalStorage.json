{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "useLocalStorage",
  "type": "registry:hook",
  "title": "useLocalStorage",
  "description": "A hook for managing local storage.",
  "registryDependencies": [
    "https://mhl5.vercel.app/r/checks.json"
  ],
  "files": [
    {
      "path": "src/registry/hooks/useLocalStorage/useLocalStorage.ts",
      "content": "\"use client\";\r\n\r\nimport { useSyncExternalStore } from \"react\";\r\n\r\ntype Serializer<T> = (value: T) => string;\r\ntype Deserializer<T> = (value: string) => T;\r\n\r\nfunction createLocalStorageStore<T>(\r\n  key: string,\r\n  defaultValue: T,\r\n  serialize: Serializer<T>,\r\n  deserialize: Deserializer<T>,\r\n) {\r\n  let currentValue: T = readFromLocalStorage(key, defaultValue, deserialize);\r\n  const listeners = new Set<() => void>();\r\n\r\n  function readFromLocalStorageInner(): T {\r\n    try {\r\n      const item = window.localStorage.getItem(key);\r\n      if (item == null) return defaultValue;\r\n      return deserialize(item);\r\n    } catch {\r\n      return defaultValue;\r\n    }\r\n  }\r\n\r\n  function notify() {\r\n    for (const listener of listeners) listener();\r\n  }\r\n\r\n  function setValue(next: T | ((prev: T) => T)) {\r\n    const resolved =\r\n      typeof next === \"function\"\r\n        ? (next as (prev: T) => T)(currentValue)\r\n        : next;\r\n\r\n    currentValue = resolved;\r\n\r\n    try {\r\n      window.localStorage.setItem(key, serialize(resolved));\r\n    } catch {\r\n      // ignore write errors (quota, private mode, etc.)\r\n    }\r\n\r\n    notify();\r\n  }\r\n\r\n  function subscribe(listener: () => void) {\r\n    listeners.add(listener);\r\n    return () => listeners.delete(listener);\r\n  }\r\n\r\n  function getSnapshot() {\r\n    return currentValue;\r\n  }\r\n\r\n  // for SSR: just use default; localStorage isn't available\r\n  function getServerSnapshot() {\r\n    return defaultValue;\r\n  }\r\n\r\n  // Sync store when other tabs or same tab modify this key or clear storage\r\n  if (\r\n    typeof window !== \"undefined\" &&\r\n    typeof window.addEventListener === \"function\"\r\n  ) {\r\n    window.addEventListener(\"storage\", (event) => {\r\n      if (event.key === key || event.key === null) {\r\n        currentValue = readFromLocalStorageInner();\r\n        notify();\r\n      }\r\n    });\r\n  }\r\n\r\n  return {\r\n    subscribe,\r\n    getSnapshot,\r\n    getServerSnapshot,\r\n    setValue,\r\n  };\r\n}\r\n\r\nfunction readFromLocalStorage<T>(\r\n  key: string,\r\n  defaultValue: T,\r\n  deserialize: Deserializer<T>,\r\n): T {\r\n  if (typeof window === \"undefined\") {\r\n    // SSR / Node: just return default\r\n    return defaultValue;\r\n  }\r\n\r\n  try {\r\n    const item = window.localStorage.getItem(key);\r\n    if (item == null) return defaultValue;\r\n    return deserialize(item);\r\n  } catch {\r\n    return defaultValue;\r\n  }\r\n}\r\n\r\nexport function useLocalStorage<T>(\r\n  key: string,\r\n  defaultValue: T,\r\n  options?: {\r\n    serialize?: Serializer<T>;\r\n    deserialize?: Deserializer<T>;\r\n  },\r\n): [T, (value: T | ((prev: T) => T)) => void] {\r\n  const serialize: Serializer<T> =\r\n    options?.serialize ?? ((value) => JSON.stringify(value));\r\n  const deserialize: Deserializer<T> =\r\n    options?.deserialize ?? ((value) => JSON.parse(value));\r\n\r\n  const store = createLocalStorageStore<T>(\r\n    key,\r\n    defaultValue,\r\n    serialize,\r\n    deserialize,\r\n  );\r\n\r\n  const value = useSyncExternalStore(\r\n    store.subscribe,\r\n    store.getSnapshot,\r\n    store.getServerSnapshot,\r\n  );\r\n\r\n  return [value, store.setValue];\r\n}\r\n",
      "type": "registry:hook"
    },
    {
      "path": "src/utils/readStorageJson.ts",
      "content": "import { isDev } from \"@/registry/utils/checks/checks\";\r\n\r\nconst INVALID_VALUES = [\"\", \"undefined\", \"null\"];\r\n\r\nexport function readStorageJsonValue<T>(\r\n  key: string,\r\n  defaultValue: T | (() => T),\r\n  storageObject: Storage,\r\n) {\r\n  try {\r\n    if (!storageObject) return _handleDefaultValue(defaultValue);\r\n\r\n    const item = storageObject.getItem(key);\r\n\r\n    if (item !== null && item !== undefined && !INVALID_VALUES.includes(item))\r\n      return JSON.parse(item);\r\n\r\n    return _handleDefaultValue(defaultValue);\r\n  } catch (error) {\r\n    if (isDev()) throw error;\r\n\r\n    return _handleDefaultValue(defaultValue);\r\n  }\r\n}\r\n\r\nconst _handleDefaultValue = <T>(defaultValue: T | (() => T)) =>\r\n  defaultValue instanceof Function ? defaultValue() : defaultValue;\r\n",
      "type": "registry:lib",
      "target": "src/utils/readStorageJson.ts"
    }
  ]
}