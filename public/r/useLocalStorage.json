{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "useLocalStorage",
  "type": "registry:hook",
  "title": "useLocalStorage",
  "description": "A hook for managing local storage.",
  "files": [
    {
      "path": "src/registry/hooks/useLocalStorage/useLocalStorage.ts",
      "content": "\"use client\";\r\n\r\nimport { useCallback, useMemo, useSyncExternalStore } from \"react\";\r\nimport { isDev } from \"@/registry/utils/checks/checks\";\r\n\r\nexport function useLocalStorage<T>(key: string, defaultValue: T | (() => T)) {\r\n  const defaultVal = useMemo(() => {\r\n    return defaultValue instanceof Function ? defaultValue() : defaultValue;\r\n  }, [defaultValue]);\r\n\r\n  const value = useSyncExternalStore(\r\n    (cb) => _subscribe(key, cb),\r\n    () => _getSnapshot(key, defaultVal, localStorage),\r\n    () => defaultVal,\r\n  );\r\n\r\n  const setValue = useCallback(\r\n    (newValue: T) => {\r\n      localStorage.setItem(key, JSON.stringify(newValue));\r\n      window.dispatchEvent(new StorageEvent(\"storage\", { key }));\r\n    },\r\n    [key],\r\n  );\r\n\r\n  return [value, setValue] as const;\r\n}\r\n\r\nfunction _subscribe(key: string, callback: () => void) {\r\n  const handler = (e: StorageEvent) => {\r\n    if (e.key === key) callback();\r\n  };\r\n  window.addEventListener(\"storage\", handler);\r\n  return () => window.removeEventListener(\"storage\", handler);\r\n}\r\n\r\nfunction _getSnapshot<T>(key: string, defaultValue: T, storageObject: Storage) {\r\n  try {\r\n    const item = storageObject.getItem(key);\r\n    if (item) return JSON.parse(item);\r\n    if (defaultValue instanceof Function) return defaultValue();\r\n    return defaultValue;\r\n  } catch (error) {\r\n    if (isDev())\r\n      throw new Error(error instanceof Error ? error.message : \"Unknown error\");\r\n\r\n    return defaultValue;\r\n  }\r\n}\r\n",
      "type": "registry:hook"
    }
  ]
}